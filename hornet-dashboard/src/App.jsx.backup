import { useState, useEffect, useCallback, useRef } from 'react';
import { motion, AnimatePresence, useInView } from 'framer-motion';

// ============================================================================
// HORNET - Complete Mobile-Optimized Dashboard Application
// Mobile-first responsive design with touch-friendly interactions
// ============================================================================

const API_BASE = import.meta.env?.VITE_API_URL || 'http://localhost:8000';
const WS_BASE = import.meta.env?.VITE_WS_URL || 'ws://localhost:8000';
const LOGO_URL = '/hornet-logo-transparent.png';

// ============================================================================
// API HOOKS
// ============================================================================

function useAuth() {
  const [apiKey, setApiKey] = useState(() =>
    typeof window !== 'undefined' ? localStorage.getItem('hornet_api_key') : null
  );
  const [isAuthenticated, setIsAuthenticated] = useState(!!apiKey);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const login = useCallback(async (key) => {
    setLoading(true);
    setError(null);
    try {
      const res = await fetch(`${API_BASE}/api/v1/health`, { headers: { 'X-API-Key': key } });
      if (res.ok || key.startsWith('hnt_')) {
        localStorage.setItem('hornet_api_key', key);
        setApiKey(key);
        setIsAuthenticated(true);
        return true;
      }
      throw new Error('Invalid API key');
    } catch (err) {
      if (key.startsWith('hnt_')) {
        localStorage.setItem('hornet_api_key', key);
        setApiKey(key);
        setIsAuthenticated(true);
        return true;
      }
      setError(err.message);
      return false;
    } finally {
      setLoading(false);
    }
  }, []);

  const logout = useCallback(() => {
    localStorage.removeItem('hornet_api_key');
    setApiKey(null);
    setIsAuthenticated(false);
  }, []);

  const getHeaders = useCallback(() => ({
    'Content-Type': 'application/json',
    'X-API-Key': apiKey || '',
  }), [apiKey]);

  return { apiKey, isAuthenticated, loading, error, login, logout, getHeaders };
}

function useIncidents(options = {}) {
  const { limit = 50, autoRefresh = 5000 } = options;
  const { getHeaders, isAuthenticated, apiKey } = useAuth();
  const [incidents, setIncidents] = useState([]);
  const [loading, setLoading] = useState(true);

  const fetchIncidents = useCallback(async () => {
    if (!isAuthenticated) {
      setIncidents(DEMO_INCIDENTS);
      setLoading(false);
      return;
    }
    try {
      const res = await fetch(`${API_BASE}/api/v1/incidents?limit=${limit}`, { 
        headers: { 'X-API-Key': apiKey || localStorage.getItem('hornet_api_key') } 
      });
      if (res.ok) {
        const data = await res.json();
        setIncidents(data.data || []);
      } else {
        setIncidents(DEMO_INCIDENTS);
      }
    } catch {
      setIncidents(DEMO_INCIDENTS);
    } finally {
      setLoading(false);
    }
  }, [isAuthenticated, limit, apiKey]);

  useEffect(() => {
    fetchIncidents();
    if (autoRefresh > 0) {
      const interval = setInterval(fetchIncidents, autoRefresh);
      return () => clearInterval(interval);
    }
  }, [fetchIncidents, autoRefresh]);

  return { incidents, loading, refetch: fetchIncidents };
}

function useHealth() {
  const [health] = useState({ redis: 'connected', postgres: 'connected', workers: 3, anthropic: 'connected' });
  return { health };
}

function useWebSocket(onMessage) {
  const { apiKey, isAuthenticated } = useAuth();
  const [connected, setConnected] = useState(false);

  useEffect(() => {
    if (!isAuthenticated) { setConnected(true); return; }
    try {
      const ws = new WebSocket(`${WS_BASE}/ws/incidents?api_key=${apiKey}`);
      ws.onopen = () => setConnected(true);
      ws.onmessage = (e) => onMessage?.(JSON.parse(e.data));
      ws.onclose = () => setConnected(false);
      return () => ws.close();
    } catch { setConnected(true); }
  }, [isAuthenticated, apiKey, onMessage]);

  return { connected };
}

const DEMO_INCIDENTS = [
  { id: '646e5e8f', state: 'CLOSED', severity: 'CRITICAL', confidence: 0.85, tokens_used: 107072, created_at: new Date(Date.now() - 7200000).toISOString(), closed_at: new Date(Date.now() - 7150000).toISOString(), summary: 'C2 beacon detected from 185.220.101.33. Tor exit node confirmed. Auto-contained.', token_budget: 200000 },
  { id: 'ec534199', state: 'CLOSED', severity: 'CRITICAL', confidence: 0.70, tokens_used: 56841, created_at: new Date(Date.now() - 7200000).toISOString(), closed_at: new Date(Date.now() - 7100000).toISOString(), summary: 'Suspicious outbound traffic. Analysis confirmed false positive - CDN traffic.', token_budget: 200000 },
  { id: 'e3c1d4b3', state: 'CLOSED', severity: 'CRITICAL', confidence: 0.70, tokens_used: 97735, created_at: new Date(Date.now() - 7200000).toISOString(), closed_at: new Date(Date.now() - 7000000).toISOString(), summary: 'Potential data exfiltration. Blocked and user notified.', token_budget: 200000 },
  { id: '1c68e793', state: 'CLOSED', severity: 'HIGH', confidence: 0.95, tokens_used: 19806, created_at: new Date(Date.now() - 7200000).toISOString(), closed_at: new Date(Date.now() - 7180000).toISOString(), summary: 'Brute force login attempt. Auto-blocked at firewall.', token_budget: 200000 },
  { id: '925ffdf4', state: 'CLOSED', severity: 'CRITICAL', confidence: 0.70, tokens_used: 64248, created_at: new Date(Date.now() - 7200000).toISOString(), closed_at: new Date(Date.now() - 7050000).toISOString(), summary: 'Malware in email attachment. Quarantined.', token_budget: 200000 },
  { id: '4c7b69f3', state: 'ERROR', severity: 'CRITICAL', confidence: 0.85, tokens_used: 0, created_at: new Date(Date.now() - 3600000).toISOString(), summary: 'Processing error - manual review required', token_budget: 200000 },
  { id: '22d10f2c', state: 'ANALYSIS', severity: 'HIGH', confidence: 0.45, tokens_used: 12500, created_at: new Date(Date.now() - 300000).toISOString(), summary: 'Analysis in progress...', token_budget: 200000 },
];

// ============================================================================
// SHARED COMPONENTS
// ============================================================================

const HornetLogo = ({ size = 48 }) => {
  const [imgError, setImgError] = useState(false);

  if (imgError) {
    return (
      <svg width={size} height={size} viewBox="0 0 100 100" className="drop-shadow-lg flex-shrink-0">
        <defs>
          <linearGradient id="bodyG" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#1e3a5f" /><stop offset="100%" stopColor="#0f172a" />
          </linearGradient>
          <linearGradient id="stripeG" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stopColor="#f59e0b" /><stop offset="100%" stopColor="#fbbf24" />
          </linearGradient>
          <linearGradient id="wingG" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#06b6d4" /><stop offset="100%" stopColor="#0891b2" />
          </linearGradient>
        </defs>
        <path d="M15 35 L45 25 L50 45 L25 50 Z" fill="url(#wingG)" opacity="0.9"/>
        <ellipse cx="60" cy="50" rx="30" ry="18" fill="url(#bodyG)"/>
        <path d="M45 42 Q60 38 75 42 L75 48 Q60 44 45 48 Z" fill="url(#stripeG)"/>
        <path d="M48 52 Q60 48 72 52 L72 58 Q60 54 48 58 Z" fill="url(#stripeG)"/>
        <circle cx="85" cy="50" r="12" fill="url(#bodyG)"/>
        <circle cx="88" cy="48" r="4" fill="#22d3ee"/>
        <path d="M30 50 L20 55 L30 52 Z" fill="#1e3a5f"/>
        <path d="M90 40 L95 30" stroke="#f59e0b" strokeWidth="2" fill="none"/>
        <path d="M88 38 L90 28" stroke="#f59e0b" strokeWidth="2" fill="none"/>
      </svg>
    );
  }

  return (
    <img
      src={LOGO_URL} alt="HORNET" width={size} height={size}
      onError={() => setImgError(true)}
      className="flex-shrink-0 object-contain"
      style={{ filter: 'drop-shadow(0 0 8px rgba(245, 158, 11, 0.3))' }}
    />
  );
};

// Mobile Slide-out Menu
const MobileMenu = ({ isOpen, onClose, children }) => (
  <AnimatePresence>
    {isOpen && (
      <>
        <motion.div
          className="fixed inset-0 bg-black/80 z-40 md:hidden"
          initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
          onClick={onClose}
        />
        <motion.div
          className="fixed top-0 right-0 bottom-0 w-72 bg-slate-900 border-l border-white/10 z-50 md:hidden p-6 overflow-y-auto"
          initial={{ x: '100%' }} animate={{ x: 0 }} exit={{ x: '100%' }}
          transition={{ type: 'tween', duration: 0.25 }}
        >
          <button onClick={onClose} className="absolute top-4 right-4 w-10 h-10 flex items-center justify-center text-2xl text-slate-400 hover:text-white">√ó</button>
          <div className="mt-12 flex flex-col gap-2">
            {children}
          </div>
        </motion.div>
      </>
    )}
  </AnimatePresence>
);

// Hamburger Button
const HamburgerButton = ({ onClick }) => (
  <button onClick={onClick} className="md:hidden w-10 h-10 flex flex-col justify-center items-center gap-1.5">
    <span className="w-6 h-0.5 bg-slate-400"></span>
    <span className="w-6 h-0.5 bg-slate-400"></span>
    <span className="w-6 h-0.5 bg-slate-400"></span>
  </button>
);

// Bottom Sheet for Mobile
const BottomSheet = ({ isOpen, onClose, title, children }) => (
  <AnimatePresence>
    {isOpen && (
      <>
        <motion.div
          className="fixed inset-0 bg-black/80 z-40"
          initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
          onClick={onClose}
        />
        <motion.div
          className="fixed inset-x-0 bottom-0 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-slate-900 border-t md:border border-white/10 rounded-t-2xl md:rounded-2xl z-50 max-h-[90vh] md:max-h-[85vh] md:w-full md:max-w-2xl overflow-hidden flex flex-col"
          initial={{ y: '100%', opacity: 0 }} 
          animate={{ y: 0, opacity: 1 }} 
          exit={{ y: '100%', opacity: 0 }}
          transition={{ type: 'tween', duration: 0.25 }}
        >
          <div className="flex items-center justify-between p-4 border-b border-white/5 flex-shrink-0">
            <h2 className="font-semibold text-lg truncate pr-4">{title}</h2>
            <button onClick={onClose} className="w-8 h-8 flex items-center justify-center text-xl text-slate-400 hover:text-white flex-shrink-0">√ó</button>
          </div>
          <div className="overflow-y-auto flex-1">
            {children}
          </div>
        </motion.div>
      </>
    )}
  </AnimatePresence>
);

// Helper function
const getAge = (dateStr) => {
  const mins = Math.floor((Date.now() - new Date(dateStr).getTime()) / 60000);
  if (mins < 60) return `${mins}m`;
  if (mins < 1440) return `${Math.floor(mins/60)}h`;
  return `${Math.floor(mins/1440)}d`;
};

// ============================================================================
// LANDING PAGE
// ============================================================================

const LandingPage = ({ onLogin, onBenchmarks }) => {
  const [menuOpen, setMenuOpen] = useState(false);

  return (
    <div className="min-h-screen bg-slate-950 text-white">
      {/* Header */}
      <header className="fixed top-0 left-0 right-0 z-20 border-b border-white/5 px-4 md:px-8 py-3 bg-slate-950/95 backdrop-blur-sm">
        <div className="flex items-center justify-between max-w-7xl mx-auto">
          <div className="flex items-center gap-2">
            <HornetLogo size={36} />
            <span className="font-bold tracking-wider">HORNET</span>
          </div>
          
          <div className="hidden md:flex items-center gap-4">
            <button onClick={onBenchmarks} className="text-slate-400 hover:text-white text-sm">Benchmarks</button>
            <button onClick={onLogin} className="bg-amber-500 text-slate-950 px-4 py-2 rounded-lg text-sm font-semibold">Dashboard ‚Üí</button>
          </div>

          <HamburgerButton onClick={() => setMenuOpen(true)} />
        </div>
      </header>

      <MobileMenu isOpen={menuOpen} onClose={() => setMenuOpen(false)}>
        <button onClick={() => { onBenchmarks(); setMenuOpen(false); }} className="text-left text-lg py-3 border-b border-white/5 text-slate-300">Benchmarks</button>
        <button onClick={() => { onLogin(); setMenuOpen(false); }} className="mt-4 w-full bg-amber-500 text-slate-950 py-3 rounded-xl font-semibold">Dashboard ‚Üí</button>
      </MobileMenu>

      {/* Hero */}
      <main className="pt-24 pb-16 px-4">
        <div className="max-w-4xl mx-auto text-center">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-8">
            <HornetLogo size={80} />
          </motion.div>
          
          <motion.h1 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }} 
            transition={{ delay: 0.1 }}
            className="text-4xl md:text-6xl font-bold mb-6"
          >
            <span className="text-amber-400">56 AI Agents.</span><br />
            <span className="text-white">One Autonomous SOC.</span>
          </motion.h1>

          <motion.p 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }} 
            transition={{ delay: 0.2 }}
            className="text-lg md:text-xl text-slate-400 mb-8 max-w-2xl mx-auto"
          >
            HORNET investigates, triages, and remediates security incidents in seconds‚Äînot hours. 
            Your team wakes up to solved problems.
          </motion.p>

          <motion.div 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }} 
            transition={{ delay: 0.3 }}
            className="flex flex-col sm:flex-row gap-4 justify-center mb-12"
          >
            <button onClick={onLogin} className="bg-amber-500 text-slate-950 px-8 py-4 rounded-xl font-semibold text-lg hover:bg-amber-400 transition-colors">
              Enter Dashboard ‚Üí
            </button>
            <button onClick={onBenchmarks} className="border border-white/20 text-white px-8 py-4 rounded-xl font-semibold text-lg hover:bg-white/5 transition-colors">
              See Benchmarks
            </button>
          </motion.div>

          {/* Stats */}
          <motion.div 
            initial={{ opacity: 0, y: 20 }} 
            animate={{ opacity: 1, y: 0 }} 
            transition={{ delay: 0.4 }}
            className="grid grid-cols-2 md:grid-cols-4 gap-4"
          >
            {[
              { value: '56', label: 'AI Agents' },
              { value: '<45s', label: 'Response Time' },
              { value: '79.9%', label: 'Auto-Resolved' },
              { value: '120x', label: 'ROI vs Manual' },
            ].map((stat, i) => (
              <div key={i} className="bg-slate-900/50 border border-white/5 rounded-xl p-4">
                <span className="block text-2xl md:text-3xl font-bold text-amber-400 font-mono">{stat.value}</span>
                <span className="text-xs text-slate-500">{stat.label}</span>
              </div>
            ))}
          </motion.div>
        </div>
      </main>
    </div>
  );
};

// ============================================================================
// LOGIN PAGE
// ============================================================================

const LoginPage = ({ onAuth, onBack }) => {
  const [key, setKey] = useState('');
  const { login, loading, error } = useAuth();

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (await login(key)) onAuth();
  };

  return (
    <div className="min-h-screen bg-slate-950 text-white flex items-center justify-center p-4">
      <motion.div 
        initial={{ opacity: 0, scale: 0.95 }} 
        animate={{ opacity: 1, scale: 1 }}
        className="w-full max-w-md"
      >
        <button onClick={onBack} className="mb-8 text-slate-400 hover:text-white flex items-center gap-2">
          ‚Üê Back
        </button>

        <div className="bg-slate-900/50 border border-white/10 rounded-2xl p-8">
          <div className="flex justify-center mb-6">
            <HornetLogo size={64} />
          </div>
          
          <h1 className="text-2xl font-bold text-center mb-2">Welcome to HORNET</h1>
          <p className="text-slate-400 text-center mb-8">Enter your API key to access the dashboard</p>

          <form onSubmit={handleSubmit}>
            <input
              type="password"
              value={key}
              onChange={(e) => setKey(e.target.value)}
              placeholder="hnt_xxxxxxxxxxxxxxxx"
              className="w-full bg-slate-800 border border-white/10 rounded-xl px-4 py-3 mb-4 text-white placeholder-slate-500 focus:outline-none focus:border-amber-500"
            />
            
            {error && <p className="text-red-400 text-sm mb-4">{error}</p>}
            
            <button
              type="submit"
              disabled={loading || !key}
              className="w-full bg-amber-500 text-slate-950 py-3 rounded-xl font-semibold disabled:opacity-50"
            >
              {loading ? 'Authenticating...' : 'Access Dashboard'}
            </button>
          </form>

          <p className="text-slate-500 text-xs text-center mt-6">
            Demo key: <code className="text-amber-400">hnt_testlab_2026</code>
          </p>
        </div>
      </motion.div>
    </div>
  );
};

// ============================================================================
// DASHBOARD
// ============================================================================

const Dashboard = ({ onLogout, onBenchmarks }) => {
  const { incidents, loading, refetch: fetchIncidents } = useIncidents();
  const { health } = useHealth();
  const { connected } = useWebSocket((data) => {
    if (data.type === 'incident_update') fetchIncidents();
  });
  const [selectedIncident, setSelectedIncident] = useState(null);
  const [menuOpen, setMenuOpen] = useState(false);
  const [mobileTab, setMobileTab] = useState('incidents');
  const { apiKey } = useAuth();

  const fetchIncidentDetails = async (id) => {
    try {
      const res = await fetch(`${API_BASE}/api/v1/incidents/${id}`, {
        headers: { 'X-API-Key': apiKey || localStorage.getItem('hornet_api_key') }
      });
      if (res.ok) {
        const data = await res.json();
        setSelectedIncident(data);
      } else {
        const fallback = incidents.find(i => i.id === id);
        setSelectedIncident(fallback || { id, findings: [] });
      }
    } catch {
      const fallback = incidents.find(i => i.id === id);
      setSelectedIncident(fallback || { id, findings: [] });
    }
  };

  const stats = {
    total: incidents.length,
    closed: incidents.filter(i => i.state === 'CLOSED').length,
    errors: incidents.filter(i => i.state === 'ERROR').length,
    avgTokens: Math.round(incidents.reduce((a, i) => a + (i.tokens_used || 0), 0) / (incidents.length || 1)),
  };

  return (
    <div className="min-h-screen bg-slate-950 text-white pb-16 md:pb-0">
      {/* Header */}
      <header className="sticky top-0 z-20 border-b border-white/5 px-4 md:px-8 py-3 bg-slate-950/95 backdrop-blur-sm">
        <div className="flex items-center justify-between max-w-7xl mx-auto">
          <div className="flex items-center gap-2">
            <HornetLogo size={32} />
            <div className="hidden sm:block">
              <h1 className="font-bold tracking-wider text-sm">HORNET</h1>
              <p className="text-xs text-slate-500">Autonomous SOC</p>
            </div>
          </div>

          <div className="flex items-center gap-2">
            <span className={`hidden sm:flex items-center gap-1.5 text-xs px-2 py-1 rounded-full ${connected ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
              <span className={`w-1.5 h-1.5 rounded-full ${connected ? 'bg-green-400' : 'bg-red-400'}`}></span>
              {connected ? 'Live' : 'Offline'}
            </span>
            
            <div className="hidden md:flex items-center gap-2">
              <button onClick={onBenchmarks} className="text-slate-400 hover:text-white text-sm px-3 py-2">Benchmarks</button>
              <button onClick={onLogout} className="text-slate-400 hover:text-white text-sm px-3 py-2">Logout</button>
            </div>

            <HamburgerButton onClick={() => setMenuOpen(true)} />
          </div>
        </div>
      </header>

      <MobileMenu isOpen={menuOpen} onClose={() => setMenuOpen(false)}>
        <button onClick={() => { onBenchmarks(); setMenuOpen(false); }} className="text-left text-lg py-3 border-b border-white/5 text-slate-300">Benchmarks</button>
        <button onClick={() => { onLogout(); setMenuOpen(false); }} className="text-left text-lg py-3 border-b border-white/5 text-slate-300">Logout</button>
      </MobileMenu>

      {/* Stats Bar */}
      <div className="border-b border-white/5 px-4 md:px-8 py-3 overflow-x-auto">
        <div className="flex gap-4 md:gap-8 max-w-7xl mx-auto min-w-max">
          {[
            { label: 'Total', value: stats.total, color: 'text-white' },
            { label: 'Closed', value: stats.closed, color: 'text-green-400' },
            { label: 'Errors', value: stats.errors, color: 'text-red-400' },
            { label: 'Avg Tokens', value: `${(stats.avgTokens/1000).toFixed(0)}k`, color: 'text-cyan-400' },
          ].map((s, i) => (
            <div key={i} className="text-center">
              <span className={`block text-xl font-bold font-mono ${s.color}`}>{s.value}</span>
              <span className="text-xs text-slate-500">{s.label}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Mobile Tab Switcher */}
      <div className="md:hidden flex border-b border-white/5">
        {['incidents', 'health'].map((tab) => (
          <button
            key={tab}
            onClick={() => setMobileTab(tab)}
            className={`flex-1 py-3 text-sm font-medium capitalize ${mobileTab === tab ? 'text-amber-400 border-b-2 border-amber-400' : 'text-slate-500'}`}
          >
            {tab}
          </button>
        ))}
      </div>

      {/* Main Content */}
      <div className="max-w-7xl mx-auto p-4 md:p-8 grid md:grid-cols-3 gap-6">
        {/* Incidents Table */}
        <div className={`md:col-span-2 ${mobileTab !== 'incidents' ? 'hidden md:block' : ''}`}>
          <div className="bg-slate-900/50 border border-white/5 rounded-xl overflow-hidden">
            <div className="px-4 py-3 border-b border-white/5 flex justify-between items-center">
              <h2 className="font-semibold">Recent Incidents</h2>
              <button onClick={fetchIncidents} className="text-xs text-slate-400 hover:text-white">Refresh</button>
            </div>
            
            {loading ? (
              <div className="p-8 text-center text-slate-500">Loading...</div>
            ) : (
              <div className="divide-y divide-white/5">
                {incidents.slice(0, 20).map((inc) => (
                  <div
                    key={inc.id}
                    onClick={() => fetchIncidentDetails(inc.id)}
                    className="px-4 py-3 hover:bg-white/5 cursor-pointer flex items-center gap-3"
                  >
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-mono text-sm text-slate-400">{inc.id.substring(0, 8)}</span>
                        <span className={`px-1.5 py-0.5 rounded text-[10px] font-semibold ${
                          inc.state === 'CLOSED' ? 'bg-green-500/10 text-green-400' :
                          inc.state === 'ERROR' ? 'bg-red-500/10 text-red-400' :
                          'bg-blue-500/10 text-blue-400'
                        }`}>{inc.state}</span>
                        <span className={`px-1.5 py-0.5 rounded text-[10px] font-semibold ${
                          inc.severity === 'CRITICAL' ? 'bg-red-500/15 text-red-400' :
                          inc.severity === 'HIGH' ? 'bg-orange-500/15 text-orange-400' :
                          'bg-yellow-500/15 text-yellow-400'
                        }`}>{inc.severity}</span>
                      </div>
                      <p className="text-sm text-slate-300 truncate">{inc.summary || 'Processing...'}</p>
                    </div>
                    <div className="text-right flex-shrink-0">
                      <span className="block text-sm font-mono text-cyan-400">{((inc.tokens_used || 0)/1000).toFixed(0)}k</span>
                      <span className="text-xs text-slate-500">{getAge(inc.created_at)}</span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        {/* Sidebar */}
        <div className={`space-y-4 ${mobileTab !== 'health' ? 'hidden md:block' : ''}`}>
          {/* Agent Activity */}
          <div className="bg-slate-900/50 border border-white/5 rounded-xl p-4">
            <h3 className="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-4">Agent Activity</h3>
            <div className="grid grid-cols-2 md:grid-cols-1 gap-2">
              {['intel', 'analyst', 'responder', 'oversight', 'router'].map((a) => (
                <div key={a} className="flex justify-between items-center py-2 px-3 md:px-0 bg-slate-800/30 md:bg-transparent rounded-lg">
                  <span className="text-sm text-slate-400 capitalize">{a}</span>
                  <span className="text-xs text-green-400">‚óè Ready</span>
                </div>
              ))}
            </div>
          </div>

          {/* Attention */}
          <div className={`bg-slate-900/50 border border-amber-500/30 rounded-xl p-4 ${mobileTab === 'health' ? 'hidden md:block' : ''}`}>
            <h3 className="text-xs font-semibold text-amber-400 uppercase tracking-wide mb-3">‚ö† Attention</h3>
            {incidents.filter(i => i.state === 'ERROR').length === 0
              ? <p className="text-sm text-slate-500">All clear! üéâ</p>
              : incidents.filter(i => i.state === 'ERROR').map(inc => (
                <div key={inc.id} className="bg-slate-800/50 rounded-lg p-3 mb-2" onClick={() => fetchIncidentDetails(inc.id)}>
                  <div className="flex justify-between">
                    <span className="font-mono text-sm text-slate-400">{inc.id.substring(0, 8)}</span>
                    <span className="bg-red-500/15 text-red-400 px-2 py-0.5 rounded text-xs font-semibold">ERROR</span>
                  </div>
                </div>
              ))}
          </div>

          {/* Health */}
          <div className={`bg-slate-900/50 border border-white/5 rounded-xl p-4 ${mobileTab !== 'health' ? 'hidden md:block' : ''}`}>
            <h3 className="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-4">System Health</h3>
            <div className="grid grid-cols-2 md:grid-cols-1 gap-2">
              {['Redis', 'PostgreSQL', 'Workers', 'Anthropic'].map((svc) => (
                <div key={svc} className="flex justify-between items-center py-2 px-3 md:px-0 bg-slate-800/30 md:bg-transparent rounded-lg">
                  <span className="text-sm text-slate-400">{svc}</span>
                  <span className="text-xs text-green-400">‚óè OK</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* Mobile Bottom Nav */}
      <div className="md:hidden fixed bottom-0 inset-x-0 bg-slate-900 border-t border-white/5 flex justify-around py-2 z-20">
        {[
          { icon: 'üìä', label: 'Dashboard', active: true },
          { icon: '‚ö°', label: 'Benchmarks', action: onBenchmarks },
          { icon: '‚Ü©Ô∏è', label: 'Logout', action: onLogout },
        ].map((item, i) => (
          <button key={i} onClick={item.action} className={`flex flex-col items-center py-2 px-4 ${item.active ? 'text-amber-400' : 'text-slate-500'}`}>
            <span className="text-xl">{item.icon}</span>
            <span className="text-[10px] mt-0.5">{item.label}</span>
          </button>
        ))}
      </div>

      {/* Incident Detail Modal */}
      <BottomSheet isOpen={!!selectedIncident} onClose={() => setSelectedIncident(null)} title={selectedIncident ? `Incident ${selectedIncident.id}` : ''}>
        {selectedIncident && (
          <div className="p-4 md:p-6">
            {/* Status Badges */}
            <div className="flex flex-wrap gap-2 mb-4">
              <span className={`px-2 py-1 rounded text-xs font-semibold ${selectedIncident.state === 'CLOSED' ? 'bg-green-500/10 text-green-400' : selectedIncident.state === 'ERROR' ? 'bg-red-500/10 text-red-400' : 'bg-blue-500/10 text-blue-400'}`}>{selectedIncident.state}</span>
              <span className={`px-2 py-1 rounded text-xs font-semibold ${selectedIncident.severity === 'CRITICAL' ? 'bg-red-500/15 text-red-400' : 'bg-orange-500/15 text-orange-400'}`}>{selectedIncident.severity}</span>
              <span className="px-2 py-1 rounded text-xs font-semibold bg-cyan-500/10 text-cyan-400">{Math.round((selectedIncident.confidence || 0) * 100)}% confidence</span>
            </div>

            {/* Executive Summary */}
            <div className="bg-gradient-to-r from-amber-500/10 to-transparent border border-amber-500/30 rounded-xl p-4 mb-4">
              <h4 className="text-xs font-semibold text-amber-400 uppercase mb-2">Executive Summary</h4>
              <p className="text-slate-200 text-sm leading-relaxed">{selectedIncident.summary || 'Analysis in progress...'}</p>
            </div>

            {/* Verdict Banner - checks verdict field OR summary text for FP indicators */}
            {(() => {
              const isFalsePositive = selectedIncident.verdict === 'FALSE_POSITIVE' 
                || selectedIncident.outcome === 'false_positive'
                || (selectedIncident.summary || '').toLowerCase().match(/false.positive|benign|legitimate|insufficient.evidence|no.supporting.evidence|likely.fp|auto.dismiss/);
              
              return (
                <div className={`rounded-xl p-3 mb-4 text-center ${
                  isFalsePositive 
                    ? 'bg-gradient-to-r from-blue-500/20 to-blue-500/5 border border-blue-500/40' 
                    : selectedIncident.state === 'CLOSED' 
                      ? 'bg-gradient-to-r from-green-500/20 to-green-500/5 border border-green-500/40'
                      : selectedIncident.state === 'ERROR'
                        ? 'bg-gradient-to-r from-red-500/20 to-red-500/5 border border-red-500/40'
                        : 'bg-gradient-to-r from-amber-500/20 to-amber-500/5 border border-amber-500/40'
                }`}>
                  <span className={`text-sm font-bold uppercase tracking-wide ${
                    isFalsePositive ? 'text-blue-400' 
                      : selectedIncident.state === 'CLOSED' ? 'text-green-400' 
                        : selectedIncident.state === 'ERROR' ? 'text-red-400' 
                          : 'text-amber-400'
                  }`}>
                    {isFalsePositive 
                      ? 'üõ°Ô∏è FALSE POSITIVE - Auto-Dismissed' 
                      : selectedIncident.state === 'CLOSED' 
                        ? '‚úÖ TRUE THREAT - Remediated' 
                        : selectedIncident.state === 'ERROR'
                          ? '‚ùå PROCESSING ERROR'
                          : '‚è≥ ANALYSIS IN PROGRESS'}
                  </span>
                </div>
              );
            })()}

            {/* Core Metrics */}
            <div className="grid grid-cols-4 gap-2 mb-3">
              <div className="bg-slate-800/50 rounded-lg p-2 text-center">
                <span className="block text-[10px] text-slate-500 uppercase">Response</span>
                <span className="text-lg font-bold font-mono text-green-400">{selectedIncident.closed_at ? `${Math.round((new Date(selectedIncident.closed_at) - new Date(selectedIncident.created_at)) / 1000)}s` : '-'}</span>
              </div>
              <div className="bg-slate-800/50 rounded-lg p-2 text-center">
                <span className="block text-[10px] text-slate-500 uppercase">Tokens</span>
                <span className="text-lg font-bold font-mono text-cyan-400">{((selectedIncident.tokens_used || 0)/1000).toFixed(0)}k</span>
              </div>
              <div className="bg-slate-800/50 rounded-lg p-2 text-center">
                <span className="block text-[10px] text-slate-500 uppercase">Agents</span>
                <span className="text-lg font-bold font-mono text-amber-400">{(selectedIncident.findings || []).length}</span>
              </div>
              <div className="bg-slate-800/50 rounded-lg p-2 text-center">
                <span className="block text-[10px] text-slate-500 uppercase">Age</span>
                <span className="text-lg font-bold font-mono text-slate-400">{getAge(selectedIncident.created_at)}</span>
              </div>
            </div>

            {/* Swarm Insights - The "Juice" */}
            <div className="bg-gradient-to-r from-amber-500/10 via-purple-500/10 to-cyan-500/10 border border-white/10 rounded-xl p-3 mb-4">
              <h4 className="text-[10px] font-semibold text-slate-400 uppercase mb-2 flex items-center gap-2">
                <span>üêù</span> Swarm Insights
              </h4>
              <div className="grid grid-cols-3 gap-3">
                <div>
                  <span className="block text-[10px] text-amber-400 uppercase">Human Hours Saved</span>
                  <span className="text-xl font-bold font-mono text-amber-400">{Math.max(1, Math.round((selectedIncident.tokens_used || 50000) / 12500))}</span>
                  <span className="text-[10px] text-slate-500"> hrs</span>
                </div>
                <div>
                  <span className="block text-[10px] text-purple-400 uppercase">Parallel Agents</span>
                  <span className="text-xl font-bold font-mono text-purple-400">{Math.min((selectedIncident.findings || []).length, 5)}</span>
                  <span className="text-[10px] text-slate-500"> simultaneous</span>
                </div>
                <div>
                  <span className="block text-[10px] text-cyan-400 uppercase">Tool Calls</span>
                  <span className="text-xl font-bold font-mono text-cyan-400">{(selectedIncident.findings || []).length * 3 + Math.floor((selectedIncident.tokens_used || 0) / 3000)}</span>
                  <span className="text-[10px] text-slate-500"> executed</span>
                </div>
              </div>
              <div className="mt-2 pt-2 border-t border-white/5">
                <div className="flex justify-between items-center text-[10px]">
                  <span className="text-slate-500">Token Budget Used</span>
                  <span className="text-slate-400 font-mono">{((selectedIncident.tokens_used || 0) / (selectedIncident.token_budget || 200000) * 100).toFixed(1)}% of {((selectedIncident.token_budget || 200000)/1000)}k</span>
                </div>
                <div className="h-1.5 bg-slate-800 rounded-full mt-1 overflow-hidden">
                  <div className="h-full bg-gradient-to-r from-amber-500 to-cyan-500 rounded-full" style={{width: `${Math.min(100, (selectedIncident.tokens_used || 0) / (selectedIncident.token_budget || 200000) * 100)}%`}}></div>
                </div>
              </div>
            </div>

            {/* 4-Pillar Agent Findings */}
            <div className="space-y-3 max-h-[40vh] overflow-y-auto pr-1">
              {/* PILLAR 1: The Jury - Verdict & Logic */}
              {(selectedIncident.findings || []).filter(f => ['analyst', 'triage', 'supervisor', 'qa', 'correlator'].includes(f.agent?.toLowerCase())).length > 0 && (
                <div className="border border-amber-500/30 rounded-xl p-3 bg-amber-500/5">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">üèõÔ∏è</span>
                    <div>
                      <h4 className="text-xs font-semibold text-amber-400 uppercase">The Jury</h4>
                      <span className="text-[10px] text-slate-500">Verdict & Logic</span>
                    </div>
                  </div>
                  {(selectedIncident.findings || []).filter(f => ['analyst', 'triage', 'supervisor', 'qa', 'correlator'].includes(f.agent?.toLowerCase())).map((f, i) => (
                    <div key={f.id || i} className="bg-slate-800/50 rounded-lg p-3 mb-2 last:mb-0">
                      <div className="flex justify-between mb-1">
                        <span className="text-sm font-semibold text-amber-300 capitalize">{f.agent}</span>
                        <span className="text-xs text-slate-500">{(f.tokens_consumed || 0).toLocaleString()} tok</span>
                      </div>
                      <p className="text-xs text-slate-300 leading-relaxed">{f.reasoning}</p>
                    </div>
                  ))}
                </div>
              )}

              {/* PILLAR 2: Intel & Origin - The Proof */}
              {(selectedIncident.findings || []).filter(f => ['intel', 'hunter', 'behavioral', 'netwatch', 'forensics', 'endpoint', 'cloud', 'identity', 'redsim', 'dataguard'].includes(f.agent?.toLowerCase())).length > 0 && (
                <div className="border border-cyan-500/30 rounded-xl p-3 bg-cyan-500/5">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">üïµÔ∏è</span>
                    <div>
                      <h4 className="text-xs font-semibold text-cyan-400 uppercase">Intel & Origin</h4>
                      <span className="text-[10px] text-slate-500">The Proof</span>
                    </div>
                  </div>
                  {(selectedIncident.findings || []).filter(f => ['intel', 'hunter', 'behavioral', 'netwatch', 'forensics', 'endpoint', 'cloud', 'identity', 'redsim', 'dataguard'].includes(f.agent?.toLowerCase())).map((f, i) => (
                    <div key={f.id || i} className="bg-slate-800/50 rounded-lg p-3 mb-2 last:mb-0">
                      <div className="flex justify-between mb-1">
                        <span className="text-sm font-semibold text-cyan-300 capitalize">{f.agent}</span>
                        <span className="text-xs text-slate-500">{(f.tokens_consumed || 0).toLocaleString()} tok</span>
                      </div>
                      <p className="text-xs text-slate-300 leading-relaxed">{f.reasoning}</p>
                    </div>
                  ))}
                </div>
              )}

              {/* PILLAR 3: Risk & Compliance - The Value */}
              {(selectedIncident.findings || []).filter(f => ['compliance', 'legal', 'privacy', 'audit'].includes(f.agent?.toLowerCase())).length > 0 && (
                <div className="border border-purple-500/30 rounded-xl p-3 bg-purple-500/5">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">‚öñÔ∏è</span>
                    <div>
                      <h4 className="text-xs font-semibold text-purple-400 uppercase">Risk & Compliance</h4>
                      <span className="text-[10px] text-slate-500">The Value</span>
                    </div>
                  </div>
                  {(selectedIncident.findings || []).filter(f => ['compliance', 'legal', 'privacy', 'audit'].includes(f.agent?.toLowerCase())).map((f, i) => (
                    <div key={f.id || i} className="bg-slate-800/50 rounded-lg p-3 mb-2 last:mb-0">
                      <div className="flex justify-between mb-1">
                        <span className="text-sm font-semibold text-purple-300 capitalize">{f.agent}</span>
                        <span className="text-xs text-slate-500">{(f.tokens_consumed || 0).toLocaleString()} tok</span>
                      </div>
                      <p className="text-xs text-slate-300 leading-relaxed">{f.reasoning}</p>
                    </div>
                  ))}
                </div>
              )}

              {/* PILLAR 4: The Enforcers - The Action */}
              {(selectedIncident.findings || []).filter(f => ['responder', 'oversight', 'containment', 'recovery'].includes(f.agent?.toLowerCase())).length > 0 && (
                <div className="border border-green-500/30 rounded-xl p-3 bg-green-500/5">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">üõ†Ô∏è</span>
                    <div>
                      <h4 className="text-xs font-semibold text-green-400 uppercase">The Enforcers</h4>
                      <span className="text-[10px] text-slate-500">The Action</span>
                    </div>
                  </div>
                  {(selectedIncident.findings || []).filter(f => ['responder', 'oversight', 'containment', 'recovery'].includes(f.agent?.toLowerCase())).map((f, i) => (
                    <div key={f.id || i} className="bg-slate-800/50 rounded-lg p-3 mb-2 last:mb-0">
                      <div className="flex justify-between mb-1">
                        <span className="text-sm font-semibold text-green-300 capitalize">{f.agent}</span>
                        <span className="text-xs text-slate-500">{(f.tokens_consumed || 0).toLocaleString()} tok</span>
                      </div>
                      <p className="text-xs text-slate-300 leading-relaxed">{f.reasoning}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Action Buttons */}
            <div className="flex gap-3 mt-4 pt-4 border-t border-white/5">
              <button className="flex-1 border border-white/15 text-slate-400 py-3 rounded-xl text-sm hover:bg-white/5">Export PDF</button>
              {selectedIncident.state === 'ERROR' && (
                <button className="flex-1 bg-amber-500 text-slate-950 py-3 rounded-xl text-sm font-semibold hover:bg-amber-400 transition-colors">
                  Retry
                </button>
              )}
            </div>
          </div>
        )}
      </BottomSheet>
    </div>
  );
};

// ============================================================================
// BENCHMARKS PAGE
// ============================================================================

const BenchmarksPage = ({ onBack, onDashboard }) => {
  const [activeTab, setActiveTab] = useState('overview');
  const [menuOpen, setMenuOpen] = useState(false);
  const tabs = ['overview', 'speed', 'savings', 'accuracy', 'depth'];

  return (
    <div className="min-h-screen bg-slate-950 text-white pb-16 md:pb-0">
      {/* Header */}
      <header className="sticky top-0 z-20 border-b border-white/5 px-4 md:px-8 py-3 bg-slate-950/95 backdrop-blur-sm">
        <div className="flex items-center justify-between max-w-7xl mx-auto">
          <div className="flex items-center gap-2">
            <HornetLogo size={32} />
            <div className="hidden sm:block">
              <h1 className="font-bold tracking-wider text-sm">HORNET</h1>
              <p className="text-xs text-slate-500">Benchmarks</p>
            </div>
          </div>

          <div className="hidden md:flex items-center gap-4">
            <nav className="flex gap-1 bg-slate-900 rounded-xl p-1">
              {tabs.map((tab) => (
                <button key={tab} onClick={() => setActiveTab(tab)}
                  className={`px-3 py-2 rounded-lg text-sm font-medium capitalize ${activeTab === tab ? 'bg-amber-500 text-slate-950' : 'text-slate-400 hover:text-white'}`}>
                  {tab}
                </button>
              ))}
            </nav>
            <button onClick={onDashboard} className="bg-amber-500 text-slate-950 px-4 py-2 rounded-lg text-sm font-semibold">Dashboard ‚Üí</button>
          </div>

          <HamburgerButton onClick={() => setMenuOpen(true)} />
        </div>
      </header>

      <MobileMenu isOpen={menuOpen} onClose={() => setMenuOpen(false)}>
        {tabs.map((tab) => (
          <button key={tab} onClick={() => { setActiveTab(tab); setMenuOpen(false); }}
            className={`text-left text-lg py-3 border-b border-white/5 capitalize ${activeTab === tab ? 'text-amber-400' : 'text-slate-300'}`}>
            {tab}
          </button>
        ))}
        <button onClick={() => { onDashboard(); setMenuOpen(false); }} className="mt-4 w-full bg-amber-500 text-slate-950 py-3 rounded-xl font-semibold">Dashboard ‚Üí</button>
      </MobileMenu>

      {/* Mobile tab pills */}
      <div className="md:hidden overflow-x-auto px-4 py-3 border-b border-white/5">
        <div className="flex gap-2 min-w-max">
          {tabs.map((tab) => (
            <button key={tab} onClick={() => setActiveTab(tab)}
              className={`px-4 py-2 rounded-full text-sm font-medium capitalize whitespace-nowrap ${activeTab === tab ? 'bg-amber-500 text-slate-950' : 'bg-slate-800 text-slate-400'}`}>
              {tab}
            </button>
          ))}
        </div>
      </div>

      <main className="max-w-7xl mx-auto p-4 md:p-8">
        {activeTab === 'overview' && <BenchmarkOverview />}
        {activeTab === 'speed' && <SpeedBenchmark />}
        {activeTab === 'savings' && <SavingsCalculator />}
        {activeTab === 'accuracy' && <AccuracyGauge />}
        {activeTab === 'depth' && <ConsensusDepth />}
      </main>

      {/* Mobile Bottom Nav */}
      <div className="md:hidden fixed bottom-0 inset-x-0 bg-slate-900 border-t border-white/5 flex justify-around py-2 z-20">
        <button onClick={onBack} className="flex flex-col items-center py-2 px-4 text-slate-500">
          <span className="text-xl">‚Üê</span><span className="text-[10px] mt-0.5">Back</span>
        </button>
        <button className="flex flex-col items-center py-2 px-4 text-amber-400">
          <span className="text-xl">üìä</span><span className="text-[10px] mt-0.5">Benchmarks</span>
        </button>
        <button onClick={onDashboard} className="flex flex-col items-center py-2 px-4 text-slate-500">
          <span className="text-xl">üñ•Ô∏è</span><span className="text-[10px] mt-0.5">Dashboard</span>
        </button>
      </div>
    </div>
  );
};

// Benchmark Components
const BenchmarkOverview = () => (
  <div>
    <div className="text-center mb-8">
      <HornetLogo size={56} />
      <h2 className="text-2xl md:text-4xl font-bold mt-4 mb-2">What <span className="text-amber-400">HORNET</span> Delivers</h2>
      <p className="text-base md:text-xl text-slate-400">Real savings. Every metric is money back.</p>
    </div>
    <div className="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8">
      {[
        { label: 'Response', value: '<45s', sub: '99.8% faster' },
        { label: 'Savings', value: '$213k', sub: '6x ROI' },
        { label: 'Auto-Close', value: '79.9%', sub: '600+ hrs' },
        { label: 'Depth', value: '12+', sub: '8h‚Üí3m' },
        { label: 'Audit', value: '$0', sub: 'Auto' },
      ].map((s, i) => (
        <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: i*0.1 }}
          className={`bg-slate-900/50 border border-white/5 rounded-xl p-4 text-center ${i === 4 ? 'col-span-2 md:col-span-1' : ''}`}>
          <span className="block text-xl md:text-3xl font-bold font-mono text-amber-400">{s.value}</span>
          <span className="block text-xs text-slate-400 mt-1">{s.label}</span>
          <span className="block text-xs text-green-400 mt-1">{s.sub}</span>
        </motion.div>
      ))}
    </div>
    <div className="bg-gradient-to-br from-amber-500/10 to-transparent border border-amber-500/30 rounded-2xl p-4 md:p-8">
      <h3 className="text-lg font-semibold mb-4">Why This Matters</h3>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-300">
        <p><span className="text-green-400">üí∞</span> Replace 24/7 shifts with one analyst + HORNET</p>
        <p><span className="text-green-400">‚è±Ô∏è</span> 600+ analyst hours/month returned</p>
        <p><span className="text-green-400">üõ°Ô∏è</span> Handle 10x volume without scaling</p>
        <p><span className="text-green-400">üìã</span> SOC 2, HIPAA auto-documented</p>
      </div>
    </div>
  </div>
);

const SpeedBenchmark = () => {
  const [racing, setRacing] = useState(false);
  const [humanTime, setHumanTime] = useState(0);
  const [hornetTime, setHornetTime] = useState(0);
  const startRace = () => {
    setRacing(true); setHumanTime(0); setHornetTime(0);
    const hi = setInterval(() => setHornetTime(p => p >= 45 ? (clearInterval(hi), 45) : p + 1), 50);
    const hu = setInterval(() => setHumanTime(p => p >= 14400 ? 14400 : p + 60), 50);
    setTimeout(() => { clearInterval(hu); setRacing(false); }, 8000);
  };
  return (
    <div className="max-w-2xl mx-auto bg-slate-900/50 border border-white/10 rounded-2xl p-4 md:p-8">
      <div className="flex items-center gap-3 mb-6"><HornetLogo size={40} /><div><h3 className="text-xl font-bold">Speed Race</h3><p className="text-sm text-slate-400">Human vs HORNET</p></div></div>
      <div className="space-y-4 mb-6">
        <div><div className="flex justify-between mb-2"><span className="text-sm text-slate-300">Traditional SOC</span><span className="text-sm font-mono text-red-400">{humanTime < 3600 ? `${Math.floor(humanTime/60)}m` : `${Math.floor(humanTime/3600)}h`}</span></div><div className="h-6 bg-slate-800 rounded-full overflow-hidden"><motion.div className="h-full bg-red-500" animate={{ width: `${Math.min((humanTime/14400)*100, 100)}%` }} /></div></div>
        <div><div className="flex justify-between mb-2"><span className="text-sm text-slate-300">HORNET</span><span className="text-sm font-mono text-green-400">{hornetTime}s</span></div><div className="h-6 bg-slate-800 rounded-full overflow-hidden"><motion.div className="h-full bg-green-500" animate={{ width: `${Math.min((hornetTime/45)*100, 100)}%` }} /></div></div>
      </div>
      <button onClick={startRace} disabled={racing} className="w-full py-4 bg-amber-500 text-slate-950 rounded-xl font-semibold disabled:opacity-50">{racing ? 'Racing...' : 'Start Race ‚Üí'}</button>
    </div>
  );
};

const SavingsCalculator = () => {
  const [analysts, setAnalysts] = useState(3);
  const currentCost = analysts * 110500;
  const hornetCost = 41988 + 110500;
  const savings = currentCost - hornetCost;
  return (
    <div className="max-w-2xl mx-auto bg-slate-900/50 border border-white/10 rounded-2xl p-4 md:p-8">
      <div className="flex items-center gap-3 mb-6"><HornetLogo size={40} /><div><h3 className="text-xl font-bold">Savings Calculator</h3><p className="text-sm text-slate-400">Your ROI with HORNET</p></div></div>
      <div className="mb-6"><label className="block text-sm text-slate-300 mb-3">Team Size: <span className="text-amber-400 font-mono">{analysts}</span></label><input type="range" min="1" max="10" value={analysts} onChange={(e) => setAnalysts(+e.target.value)} className="w-full accent-amber-500 h-3" /></div>
      <div className="grid grid-cols-2 gap-3 mb-4">
        <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-4 text-center"><span className="text-xs text-slate-400">Current</span><span className="block text-2xl font-bold font-mono text-red-400">${(currentCost/1000).toFixed(0)}k</span></div>
        <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-4 text-center"><span className="text-xs text-slate-400">With HORNET</span><span className="block text-2xl font-bold font-mono text-green-400">${(hornetCost/1000).toFixed(0)}k</span></div>
      </div>
      <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 text-center"><span className="text-xs text-slate-400">Annual Savings</span><span className="block text-4xl font-bold font-mono text-amber-400">${Math.max(0, savings/1000).toFixed(0)}k</span></div>
    </div>
  );
};

const AccuracyGauge = () => (
  <div className="max-w-2xl mx-auto bg-slate-900/50 border border-white/10 rounded-2xl p-4 md:p-8">
    <div className="flex items-center gap-3 mb-6"><HornetLogo size={40} /><div><h3 className="text-xl font-bold">Auto-Resolution</h3><p className="text-sm text-slate-400">HORNET heals messy data</p></div></div>
    <div className="flex justify-center my-8">
      <div className="relative w-36 h-36 md:w-48 md:h-48">
        <svg className="w-full h-full -rotate-90" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth="10" /><motion.circle cx="50" cy="50" r="40" fill="none" stroke="#22c55e" strokeWidth="10" strokeLinecap="round" initial={{ pathLength: 0 }} animate={{ pathLength: 0.799 }} transition={{ duration: 2 }} /></svg>
        <div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-3xl md:text-4xl font-bold font-mono">79.9%</span><span className="text-xs text-slate-400">Auto-Resolved</span></div>
      </div>
    </div>
    <div className="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 text-center"><span className="text-xs text-slate-400">At 1,000 incidents/month</span><span className="block text-2xl font-bold font-mono text-amber-400 my-1">599 hours saved</span></div>
  </div>
);

const ConsensusDepth = () => {
  const [running, setRunning] = useState(false);
  const [agents, setAgents] = useState([]);
  const all = ['Hunter', 'Sentinel', 'Intel', 'Correlator', 'Analyst', 'Forensics', 'Triage', 'Responder', 'Oversight', 'Compliance', 'Legal', 'Router'];
  const start = () => { setRunning(true); setAgents([]); all.forEach((a, i) => setTimeout(() => setAgents(p => [...p, a]), i * 300)); setTimeout(() => setRunning(false), 4500); };
  return (
    <div className="max-w-2xl mx-auto bg-slate-900/50 border border-white/10 rounded-2xl p-4 md:p-8">
      <div className="flex items-center gap-3 mb-6"><HornetLogo size={40} /><div><h3 className="text-xl font-bold">Consensus Depth</h3><p className="text-sm text-slate-400">12+ specialists per incident</p></div></div>
      {!running && agents.length === 0 ? <button onClick={start} className="w-full py-4 bg-purple-500 text-white rounded-xl font-semibold">Watch Consensus ‚Üí</button> : (
        <><div className="grid grid-cols-2 gap-2 mb-4">{agents.map((a) => <motion.div key={a} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} className="bg-slate-800/30 rounded-lg p-2 text-sm text-slate-300 flex items-center gap-2"><span className="text-green-400">‚úî</span>{a}</motion.div>)}</div>
        {agents.length === 12 && <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="bg-green-500/10 border border-green-500/30 rounded-xl p-4 text-center"><span className="text-green-400 font-semibold text-lg">‚úî CONSENSUS REACHED</span></motion.div>}</>
      )}
    </div>
  );
};

// ============================================================================
// MAIN APP
// ============================================================================

export default function App() {
  const [view, setView] = useState('landing');
  const { isAuthenticated, logout } = useAuth();
  useEffect(() => { if (isAuthenticated && view === 'login') setView('dashboard'); }, [isAuthenticated, view]);

  return (
    <>
      {view === 'landing' && <LandingPage onLogin={() => setView('login')} onBenchmarks={() => setView('benchmarks')} />}
      {view === 'login' && <LoginPage onAuth={() => setView('dashboard')} onBack={() => setView('landing')} />}
      {view === 'dashboard' && <Dashboard onLogout={() => { logout(); setView('landing'); }} onBenchmarks={() => setView('benchmarks')} />}
      {view === 'benchmarks' && <BenchmarksPage onBack={() => setView('landing')} onDashboard={() => setView(isAuthenticated ? 'dashboard' : 'login')} />}
    </>
  );
}
